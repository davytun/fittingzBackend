generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id                 String              @id @default(cuid())
  email              String              @unique
  password           String
  businessName       String
  contactPhone       String?
  businessAddress    String?
  isEmailVerified    Boolean             @default(false)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  clients            Client[]
  Event              Event[]
  Order              Order[]
  Project            Project[]
  styleImages        StyleImage[]
  verificationTokens VerificationToken[]
  notifications      Notification[]
  recentUpdates      RecentUpdate[]
}

model VerificationToken {
  id        String    @id @default(cuid())
  token     String    @unique
  type      TokenType
  email     String
  adminId   String?
  expiresAt DateTime
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  admin     Admin?    @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@index([email, type])
  @@index([adminId])
}

model Project {
  id          String        @id @default(cuid())
  name        String
  description String?
  status      ProjectStatus @default(PENDING)
  startDate   DateTime?
  dueDate     DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  clientId    String
  adminId     String
  Order       Order[]
  admin       Admin         @relation(fields: [adminId], references: [id], onDelete: Cascade)
  client      Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([adminId])
  @@index([status])
}

model Order {
  id               String            @id @default(cuid())
  orderNumber      String
  price            Decimal           @db.Decimal(10, 2)
  currency         String            @default("NGN")
  dueDate          DateTime?
  status           OrderStatus       @default(PENDING_PAYMENT)
  note             String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  clientId         String
  adminId          String
  projectId        String?
  deposit          Decimal?          @db.Decimal(10, 2)
  styleDescription String?
  eventId          String?
  details          Json?
  admin            Admin             @relation(fields: [adminId], references: [id], onDelete: Cascade)
  client           Client            @relation(fields: [clientId], references: [id], onDelete: Cascade)
  event            Event?            @relation(fields: [eventId], references: [id])
  project          Project?          @relation(fields: [projectId], references: [id])
  styleImages      OrderStyleImage[]
  payments         Payment[]
  measurements     Measurement[]

  @@index([clientId])
  @@index([adminId])
  @@index([projectId])
  @@index([eventId])
  @@index([status])
  @@index([orderNumber])
}

model OrderStyleImage {
  id           String     @id @default(cuid())
  orderId      String
  styleImageId String
  createdAt    DateTime   @default(now())
  order        Order      @relation(fields: [orderId], references: [id], onDelete: Cascade)
  styleImage   StyleImage @relation(fields: [styleImageId], references: [id], onDelete: Cascade)

  @@unique([orderId, styleImageId])
  @@index([orderId])
  @@index([styleImageId])
}

model Client {
  id                String        @id @default(cuid())
  name              String
  phone             String?
  email             String?
  gender            String?
  eventType         String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  adminId           String
  additionalDetails String?
  bodyShape         String?
  dislikedColors    String[]      @default([])
  favoriteColors    String[]      @default([])
  preferredStyles   String[]      @default([])
  admin             Admin         @relation(fields: [adminId], references: [id])
  events            EventClient[]
  measurements      Measurement[]
  Order             Order[]
  Project           Project[]
  styleImages       StyleImage[]

  @@index([adminId])
}

model Measurement {
  id        String   @id @default(cuid())
  name      String?
  clientId  String
  orderId   String?
  fields    Json
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  order     Order?   @relation(fields: [orderId], references: [id])

  @@index([clientId])
  @@index([orderId])
  @@index([isDefault])
}

model StyleImage {
  id               String            @id @default(cuid())
  clientId         String?
  adminId          String
  imageUrl         String
  publicId         String
  category         String?
  description      String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  orderStyleImages OrderStyleImage[]
  admin            Admin             @relation(fields: [adminId], references: [id], onDelete: Cascade)
  client           Client?           @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([adminId])
  @@index([category])
}

model Event {
  id          String        @id @default(cuid())
  name        String
  description String?
  eventDate   DateTime?
  location    String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  adminId     String
  admin       Admin         @relation(fields: [adminId], references: [id], onDelete: Cascade)
  clients     EventClient[]
  orders      Order[]

  @@index([adminId])
}

model EventClient {
  id        String   @id @default(cuid())
  eventId   String
  clientId  String
  role      String?
  createdAt DateTime @default(now())
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([eventId, clientId])
  @@index([eventId])
  @@index([clientId])
}

model Payment {
  id          String   @id @default(cuid())
  orderId     String
  amount      Decimal  @db.Decimal(10, 2)
  paymentDate DateTime @default(now())
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
}

enum TokenType {
  EMAIL_VERIFICATION
  PASSWORD_RESET
}

enum ProjectStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  ON_HOLD
  CANCELLED
}

model RecentUpdate {
  id          String   @id @default(cuid())
  adminId     String
  type        String
  title       String
  description String?
  entityId    String?
  entityType  String?
  createdAt   DateTime @default(now())
  admin       Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@index([adminId])
  @@index([createdAt])
}

model Notification {
  id         String              @id @default(cuid())
  adminId    String
  type       NotificationType
  priority   NotificationPriority @default(MEDIUM)
  title      String
  message    String
  isRead     Boolean             @default(false)
  entityId   String?
  entityType String?
  actionUrl  String?
  createdAt  DateTime            @default(now())
  readAt     DateTime?
  admin      Admin               @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@index([adminId])
  @@index([isRead])
  @@index([createdAt])
}

enum NotificationType {
  ORDER_UPDATE
  PAYMENT_RECEIVED
  CLIENT_MESSAGE
  CLIENT_ADDED
  SYSTEM_ALERT
  REMINDER
}

enum NotificationPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum OrderStatus {
  PENDING_PAYMENT
  PROCESSING
  READY_FOR_PICKUP
  SHIPPED
  DELIVERED
  COMPLETED
  CANCELLED
}
